## 2.3.3 
Answer:最大交换次数：N / 2  
在快速排序中，一个元素要被交换，有以下两种情况  
1.该元素是枢轴，在切分的最后一步被交换  
2.该元素位于枢轴错误的一侧，需要被交换到另一侧去  
注意，以上两种情况在一次切分中只会出现一次  

首先来看第一种情况，如果一个元素变成了枢轴,那么在之后的切分中该元素会被排除，不存在后续的交换。  
因此我们的目标应该是：最大的元素总是出现在错误的一侧，同时切分的次数尽可能多。  

接下来我们来思考如何构造这样的数组  
由于我们针对的是最大的元素，因此「错误的一侧」就是枢轴的左侧。为了使切分的次数尽可能多，我们需要保持最大值移动的距离尽量短。  
但如果每次只移动一位的话，下一次切分时最大值就会变成枢轴  
例如 4 10 3 5 6，枢轴为 4，交换后数组变为： 
4 3 10 5 6  
随后 4 和 3 交换   
3 4 10 5 6  
下一次切分时 10 会变成枢轴，不再参与后续的切分。  因此我们需要让最大值每次移动两个元素。  

考虑下面的数组：  
2 10 4 1 6 3 8 5 7 9  
第一次切分的时候，枢轴为 2，10 和 1 进行交换  
数组变为：  
2 1 4 10 6 3 8 5 7 9  
随后枢轴交换，数组变为：  
1 2 4 10 6 3 8 5 7 9  
第二次切分，枢轴为 4，10 和 3 进行交换。  
1 2 4 3 6 10 8 5 7 9  
随后枢轴交换 数组变为：  
1 2 3 4 6 10 8 5 7 9  
第三次切分，枢轴为 6，10 和 5 交换  
1 2 3 4 6 5 8 10 7 9  
随后枢轴交换，数组变为：  
1 2 3 4 5 6 8 10 7 9  
第四次切分，枢轴为 8，10 和 7 交换  
1 2 3 4 5 6 8 7 10 9  
枢轴交换，数组变为  
1 2 3 4 5 6 7 8 10 9  
最后一次切分，枢轴为 10，直接交换  
1 2 3 4 5 6 7 8 9 10  

我们可以总结出要构造这样的数组的模板  
a2 max a3 a1  
其中 a1 < a2 < a3 < max  
max 每轮切分移动两格，总共切分 N/ 2 次。  
  
另请参阅  
[Number of largest element exchanges for quicksort-Stack Overflow](https://stackoverflow.com/questions/43263249/number-of-largest-element-exchanges-for-quicksort)

## 2.3.4
1 2 3 4 5 6 7 8 9 10  
2 3 4 5 6 7 8 9 10 11  
3 4 5 6 7 8 9 10 11 12  
4 5 6 7 8 9 10 11 12 13  
5 6 7 8 9 10 11 12 13 14  
6 7 8 9 10 11 12 13 14 15  

## 2.3.5
见程序Exe2_3_5

## 2.3.6
N		准确值	估计值  
100		810		921  
1000	13018	13815  
10000	180084	184206  
程序见Exe2.3.6


## 2.3.7
N		0		1		2  
100		50		34		16  
1000	537		379		184  
10000	5507	3695	1898  
程序见Exe2.3.7

## 2.3.8
每次切分都会把数组平分，共切分 logN 次（二分法），每次切分比较 N 次（i 和 j 会一位一位地从两边向中间靠拢）。共比较 NlogN 次。

## 2.3.9
切分时，枢轴左侧都是小于（或等于）枢轴的，右侧都是大于（或等于）枢轴的
只有两种主键值时，第一次切分之后，某一侧的元素将全部相同（如果枢轴选了较大的，那么右侧将全部相同，反之则左侧全部相同）  

只有三种主键值时，和一般快速排序并无不同。但如果第一次切分时选择了中间值作为枢轴，且中间值只有一个那么只需要一次切分数组便会有序。

## 2.3.11
只有若干种元素值意味着大量的连续重复。（由于存在打乱这一步骤，不存在连续重复的可能性是很低的）  
接下来我们考虑这样的连续重复在修改后的快排下的性能。  
1 1 1 1 1 1 1  
对于这样的数组，枢轴选为 1，j 将会在 j = lo 处终止。因此最后的结果将是每次只有数组的第一个元素被排序  
已知每次切分都是 O(k - 1) 的（i 和 j 都将走完整个子数组）因此这样的快速排序所需时间 = 2(N−1+N−2+⋯+1)=(N−1)N  
因此对于值相同的子数组，这样的快排运行时间是平方级别的那么当数组中这样的连续重复内容越多，运行时间就越接近平方级别。  

## 2.3.17
见程序Exe2_3_17

## 2.3.18
每次切分时都取前三个元素的中位数作为枢轴，这可以带来约 5%~10% 的性能提升。  
这里通过三次比较将前三个数排序，然后把三个数中的中位数放到数组开头，最大值放到数组末尾。    
最大值被放到了末尾，枢轴不可能大于末尾的这个数，因此右边界判断可以去掉。    
同时由于枢轴不可能小于自身，因此左边界判断也可以去掉。  这样就可以把切分中的两个边界判断全部去掉了。  
最后对于大小为 2 的数组做特殊处理，通过一次比较直接排序并返回。  
见程序Exe2_3_18

## 2.3.19
见程序Exe2_3_19
